"use strict";(self["webpackChunkonelist_web"]=self["webpackChunkonelist_web"]||[]).push([[712],{3712:function(e,l,a){a.r(l),a.d(l,{default:function(){return B}});var t=a(2206),i=a(8912);const o=e=>((0,t.dD)("data-v-4e2d3c42"),e=e(),(0,t.Cn)(),e),s={key:0,class:"load"},r={key:1,class:"content"},d={class:"content-header"},n=o((()=>(0,t._)("div",{class:"content-header-title"}," 挂载目录 ",-1))),u={class:"content-header-tool"},w=o((()=>(0,t._)("i",{class:"bx bx-analyse"},null,-1))),h=(0,t.Uk)(" 刷新 "),c=o((()=>(0,t._)("i",{class:"bx bx-plus-circle"},null,-1))),p=(0,t.Uk)(" 新增挂载 "),m={class:"work-list"},_=o((()=>(0,t._)("i",{class:"bx bx-detail"},null,-1))),k={class:"progres-content"},g={class:"work-tool"},f={class:"work-data"},M={class:"work-type"},v={class:"work-alist"},b={class:"work-watching"},W=o((()=>(0,t._)("i",{class:"bx bx-error"},null,-1))),y=(0,t.Uk)(" 出错文件 "),x=o((()=>(0,t._)("i",{class:"bx bx-plus-circle"},null,-1))),C=(0,t.Uk)(" 重新刮削 "),O=o((()=>(0,t._)("i",{class:"bx bx-x"},null,-1))),z=o((()=>(0,t._)("i",{class:"bx bx-save"},null,-1))),U=(0,t.Uk)(" 创建 "),N=o((()=>(0,t._)("i",{class:"bx bx-x"},null,-1))),F=o((()=>(0,t._)("i",{class:"bx bx-trash"},null,-1))),H=(0,t.Uk)(" 删除 "),S=o((()=>(0,t._)("i",{class:"bx bx-save"},null,-1))),j=(0,t.Uk)(" 更新 "),R=o((()=>(0,t._)("i",{class:"bx bx-x"},null,-1))),A=o((()=>(0,t._)("h3",null,"确定重新刮削此挂载目录吗？",-1))),$=o((()=>(0,t._)("i",{class:"bx bx-check"},null,-1))),q=(0,t.Uk)(" 确定 ");function D(e,l,a,o,D,E){const I=(0,t.up)("n-button"),K=(0,t.up)("n-space"),Y=(0,t.up)("n-progress"),Z=(0,t.up)("n-card"),B=(0,t.up)("n-gi"),G=(0,t.up)("n-grid"),J=(0,t.up)("n-input"),L=(0,t.up)("n-form-item"),P=(0,t.up)("n-switch"),Q=(0,t.up)("n-form"),T=(0,t.up)("n-spin"),V=(0,t.up)("n-modal");return o.loading?((0,t.wg)(),(0,t.iD)("div",s)):((0,t.wg)(),(0,t.iD)("div",r,[(0,t._)("div",d,[n,(0,t._)("div",u,[(0,t.Wm)(K,{justify:"end",size:"medium"},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{onClick:l[0]||(l[0]=e=>o.reF()),type:"info"},{icon:(0,t.w5)((()=>[w])),default:(0,t.w5)((()=>[h])),_:1}),(0,t.Wm)(I,{onClick:l[1]||(l[1]=e=>E.CreateShow()),type:"info"},{icon:(0,t.w5)((()=>[c])),default:(0,t.w5)((()=>[p])),_:1})])),_:1})])]),(0,t._)("div",m,[(0,t.Wm)(G,{"x-gap":"12","y-gap":"12",cols:"1 s:2 m:2 l:4 xl:4 2xl:8",responsive:"screen"},{default:(0,t.w5)((()=>[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(o.data,((e,l)=>((0,t.wg)(),(0,t.j4)(B,{key:l},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{title:"目录"},{"header-extra":(0,t.w5)((()=>[(0,t.Wm)(I,{onClick:l=>E.Editwork(e),strong:"",secondary:"",circle:""},{default:(0,t.w5)((()=>[_])),_:2},1032,["onClick"])])),footer:(0,t.w5)((()=>[(0,t._)("div",g,[(0,t._)("div",f,[(0,t.Wm)(K,{justify:"start",size:"medium",vertical:""},{default:(0,t.w5)((()=>[(0,t._)("div",M," 挂载目录："+(0,i.zw)(e.path),1),(0,t._)("div",v," 已完成："+(0,i.zw)(e.is_ok?"是":"否"),1),(0,t._)("div",b," 监控中："+(0,i.zw)(e.watching?"是":"否"),1)])),_:2},1024)]),(0,t.Wm)(K,{justify:"end",size:"medium"},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{onClick:l=>E.ErrFiles(e),type:"error"},{icon:(0,t.w5)((()=>[W])),default:(0,t.w5)((()=>[y])),_:2},1032,["onClick"]),(0,t.Wm)(I,{onClick:l=>E.showReNew(e),type:"info"},{icon:(0,t.w5)((()=>[x])),default:(0,t.w5)((()=>[C])),_:2},1032,["onClick"])])),_:2},1024)])])),default:(0,t.w5)((()=>[(0,t._)("div",k,[(0,t.Wm)(Y,{type:"circle",percentage:(100*e.speed/e.file_number).toFixed(0)},null,8,["percentage"])])])),_:2},1024)])),_:2},1024)))),128))])),_:1})]),(0,t.Wm)(V,{class:"create",show:o.showModal,"onUpdate:show":l[7]||(l[7]=e=>o.showModal=e),"transform-origin":"center"},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{style:{width:"600px"},title:"创建",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":(0,t.w5)((()=>[(0,t.Wm)(I,{onClick:l[2]||(l[2]=e=>o.showModal=!o.showModal),strong:"",secondary:"",circle:""},{default:(0,t.w5)((()=>[O])),_:1})])),footer:(0,t.w5)((()=>[(0,t.Wm)(K,{justify:"end",size:"medium"},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{onClick:l[6]||(l[6]=e=>E.Create()),type:"info"},{icon:(0,t.w5)((()=>[z])),default:(0,t.w5)((()=>[U])),_:1})])),_:1})])),default:(0,t.w5)((()=>[(0,t.Wm)(T,{show:o.show},{default:(0,t.w5)((()=>[(0,t.Wm)(Q,{model:o.work},{default:(0,t.w5)((()=>[(0,t.Wm)(L,{label:"目录"},{default:(0,t.w5)((()=>[(0,t.Wm)(J,{onFocus:E.handleFocus,size:"large",value:o.work.path,"onUpdate:value":l[3]||(l[3]=e=>o.work.path=e),placeholder:"",clearable:""},null,8,["onFocus","value"])])),_:1}),(0,t.Wm)(L,{label:"是否强制刷新alist缓存后再获取文件?"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{size:"large",value:o.work.is_ref,"onUpdate:value":l[4]||(l[4]=e=>o.work.is_ref=e),placeholder:"",clearable:""},null,8,["value"])])),_:1}),(0,t.Wm)(L,{label:"是否监控目录,每天晚上2点自动扫描?"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{size:"large",value:o.work.watching,"onUpdate:value":l[5]||(l[5]=e=>o.work.watching=e),placeholder:"",clearable:""},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1},8,["show"])])),_:1})])),_:1},8,["show"]),(0,t.Wm)(V,{class:"update",show:o.updateModal,"onUpdate:show":l[15]||(l[15]=e=>o.updateModal=e),"transform-origin":"center"},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{style:{width:"600px"},title:"更新",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":(0,t.w5)((()=>[(0,t.Wm)(I,{onClick:l[8]||(l[8]=e=>o.updateModal=!o.updateModal),strong:"",secondary:"",circle:""},{default:(0,t.w5)((()=>[N])),_:1})])),footer:(0,t.w5)((()=>[(0,t.Wm)(K,{justify:"end",size:"medium"},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{onClick:l[13]||(l[13]=e=>E.Delete()),type:"warning"},{icon:(0,t.w5)((()=>[F])),default:(0,t.w5)((()=>[H])),_:1}),(0,t.Wm)(I,{onClick:l[14]||(l[14]=e=>E.Update()),type:"info"},{icon:(0,t.w5)((()=>[S])),default:(0,t.w5)((()=>[j])),_:1})])),_:1})])),default:(0,t.w5)((()=>[(0,t.Wm)(Q,{model:o.work},{default:(0,t.w5)((()=>[(0,t.Wm)(L,{label:"目录"},{default:(0,t.w5)((()=>[(0,t.Wm)(J,{size:"large",value:o.work.path,"onUpdate:value":l[9]||(l[9]=e=>o.work.path=e),placeholder:"",clearable:""},null,8,["value"])])),_:1}),(0,t.Wm)(L,{label:"封面图片"},{default:(0,t.w5)((()=>[(0,t.Wm)(J,{size:"large",value:o.work.image,"onUpdate:value":l[10]||(l[10]=e=>o.work.image=e),placeholder:"",clearable:""},null,8,["value"])])),_:1}),(0,t.Wm)(L,{label:"是否强制刷新alist缓存后再获取文件?"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{size:"large",value:o.work.is_ref,"onUpdate:value":l[11]||(l[11]=e=>o.work.is_ref=e),placeholder:"",clearable:""},null,8,["value"])])),_:1}),(0,t.Wm)(L,{label:"是否监控目录，每天晚上2点自动扫描?"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{size:"large",value:o.work.watching,"onUpdate:value":l[12]||(l[12]=e=>o.work.watching=e),placeholder:"",clearable:""},null,8,["value"])])),_:1})])),_:1},8,["model"])])),_:1})])),_:1},8,["show"]),(0,t.Wm)(V,{class:"renew","transform-origin":"center",show:o.renewModal,"onUpdate:show":l[19]||(l[19]=e=>o.renewModal=e)},{default:(0,t.w5)((()=>[(0,t.Wm)(Z,{style:{width:"600px"},title:"确认",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":(0,t.w5)((()=>[(0,t.Wm)(I,{onClick:l[16]||(l[16]=e=>o.renewModal=!o.renewModal),strong:"",secondary:"",circle:""},{default:(0,t.w5)((()=>[R])),_:1})])),footer:(0,t.w5)((()=>[(0,t.Wm)(K,{justify:"end",size:"medium"},{default:(0,t.w5)((()=>[(0,t.Wm)(I,{onClick:l[18]||(l[18]=e=>E.ReNewWork()),type:"info"},{icon:(0,t.w5)((()=>[$])),default:(0,t.w5)((()=>[q])),_:1})])),_:1})])),default:(0,t.w5)((()=>[A,(0,t.Wm)(L,{label:"是否全部重新刮削(默认只刮削挂载目录中新增文件)?"},{default:(0,t.w5)((()=>[(0,t.Wm)(P,{size:"large",value:o.allFile,"onUpdate:value":l[17]||(l[17]=e=>o.allFile=e),placeholder:"",clearable:""},null,8,["value"])])),_:1})])),_:1})])),_:1},8,["show"])]))}var E=a(9356),I=a(3421),K={name:"WorkIndex",setup(){const e=(0,I.iH)(!0),l=(0,I.iH)(!1),a=(0,I.iH)(!1),i=(0,I.iH)(!1),o=(0,I.iH)(!1),s=(0,I.iH)(!1),r=(0,I.iH)(null),d=(0,I.iH)(null),n=(0,I.iH)(null),{proxy:u}=(0,t.FN)(),w=(0,I.iH)(1),h=(0,I.iH)(24);r.value=u.$route.query.gallery_uid;const c=(0,E.U)(),p=(0,I.iH)({id:null,gallery_id:null,gallery_uid:"",image:"",path:"",file_number:0,speed:0,is_ok:!1,watching:!1,is_ref:!1});function m(){u.axios.post(u.COMMON.apiUrl+"/v1/api/work/gallery/list?page="+w.value+"&size="+h.value+"&id="+r.value,{},{headers:{"content-type":"application/json",Authorization:u.$cookies.get("Authorization")}}).then((l=>{200==l.data.code?(n.value=l.data.data,e.value=!1):u.COMMON.ShowMsg(l.data.msg)})).catch((e=>{u.COMMON.ShowMsg(e)}))}const _=async()=>{m()};return(0,t.bv)((()=>{m()})),{allFile:a,data:n,error:d,message:c,loading:e,gallery_uid:r,showModal:i,page:w,work:p,show:l,size:h,updateModal:o,renewModal:s,reF:_,typeOptions:["movie","tv"].map((e=>({label:e,value:e})))}},methods:{handleFocus(){this.message.info("比如'http://alist.cn/云盘/电影'就应该输入'/云盘/电影',或者是本地文件夹绝对路径",{duration:8e3})},CreateShow(){this.work={id:null,gallery_id:null,gallery_uid:"",image:"",path:"",file_number:0,speed:0,is_ok:!1,watching:!1,is_ref:!1},this.work.gallery_uid=this.gallery_uid,this.showModal=!this.showModal},Editwork(e){this.work=e,this.updateModal=!this.updateModal},showReNew(e){this.work=e,this.renewModal=!this.renewModal},ReNewWork(){let e="new";this.allFile&&(e="all"),this.Request(this.COMMON.apiUrl+"/v1/api/work/renew?id="+this.work.id+"&mod="+e,{})},Request(e,l){this.axios.post(e,l,{headers:{"content-type":"application/json",Authorization:this.$cookies.get("Authorization")}}).then((e=>{200==e.data.code?(this.COMMON.ShowMsg(e.data.msg),this.showModal=!1,this.updateModal=!1,this.renewModal=!1,this.reF()):this.COMMON.ShowMsg(e.data.msg)})).catch((e=>{this.COMMON.ShowMsg(e)}))},Create(){"tv"==this.work.work_type&&(this.work.is_tv=!0),this.show=!0;let e=this.COMMON.apiUrl+"/v1/api/work/create";this.axios.post(e,this.work,{headers:{"content-type":"application/json",Authorization:this.$cookies.get("Authorization")}}).then((e=>{200==e.data.code?(this.COMMON.ShowMsg(e.data.msg),this.reF()):this.COMMON.ShowMsg(e.data.msg),this.show=!1,this.showModal=!this.showModal})).catch((e=>{this.COMMON.ShowMsg(e),this.show=!1}))},Update(){this.Request(this.COMMON.apiUrl+"/v1/api/work/update?id="+this.work.id,this.work)},Delete(){this.Request(this.COMMON.apiUrl+"/v1/api/work/delete?id="+this.work.id,{})},ErrFiles(e){this.$router.push({path:"/gallerys/works/errfiles",query:{id:e.id}})},RefErrFiles(e){this.axios.post(`${this.COMMON.apiUrl}/v1/api/errfile/ref/work/list?id=${e.id}`,{},{headers:{"content-type":"application/json",Authorization:this.$cookies.get("Authorization")}}).then((e=>{this.COMMON.ShowMsg(e.data.msg)})).catch((e=>{this.COMMON.ShowMsg(e)}))}}},Y=a(475);const Z=(0,Y.Z)(K,[["render",D],["__scopeId","data-v-4e2d3c42"]]);var B=Z}}]);
//# sourceMappingURL=712.6453cde2.js.map